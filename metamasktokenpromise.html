<!DOCTYPE html>
<html lang="en">
<head>
  <title>Browser Transactions</title>
  <script src="https://unpkg.com/@metamask/legacy-web3@latest/dist/metamask.web3.min.js"></script> 
  <script src="erc20tokenabi.js"> </script>
  <script>
  
  window.addEventListener('load', async () => {
    // Modern dapp browsers...
    if (window.ethereum) {
        window.web3 = new Web3(ethereum);
        try {
            // Request account access if needed
            await ethereum.enable();
        } catch (error) {
            alert("Cannot access user ethereum account") ; 
        }
    }
    // Legacy dapp browsers...
    else if (window.web3) {
        window.web3 = new Web3(web3.currentProvider);
    }
    // Non-dapp browsers...
    else {
        alert('Non-Ethereum browser detected. You should consider trying MetaMask!');
    }
    
  } ) ; 
  
  function gettokenbalance() {
     var contract = web3.eth.contract(erc20tokenabi).at("0xA38b33aD1AE125c36B541daCe6E9022Bdd1fafef");
     var fromaddr = document.getElementById("fromaddr").value ;
     var mypromise = new Promise(function(resolve, reject) {
        contract.balanceOf(fromaddr,function(error, response) {
        //web3.eth.getBalance(fromaddr,function(error, response) {
            if (error) { 
                reject(error); 
            } 
            else { 
                resolve(response); 
            }
         }) ; 
     });
     mypromise.then(
         function(result) {
           document.getElementById("status").innerHTML = "Balance:" + result ;  
         }, 
         function(err) {
           console.log(err); 
     });
  } 
    
  </script>
</head>
<body>

<h1>Browser Transactions</h1>

<form>
<p> Addr: <textarea id="fromaddr" rows="1" cols="100"></textarea> </p>
</form>
<button onclick="gettokenbalance()">Get Token Balance</button>
<p id="status"></p>

</body>
</html>
